## 插件需求文档

### 背景与目标
- 该插件的核心原理是通过为文件名添加或去除「.」前缀，快速控制 Obsidian 对文件的索引。  
- 有些场景下，用户希望临时隐藏某些笔记文件（如草稿、敏感笔记等），也希望在需要时迅速恢复显示；本插件即满足此类需求。

### 核心功能
1. 一键添加前缀或去除前缀  
   - 在 Obsidian 命令面板或右键菜单中，对当前选中文件或文件夹内所有文件执行添加「.」前缀操作（隐藏）或去除「.」前缀（恢复）。  
2. 忽略规则管理（类似 .gitignore）  
   - 在插件设置面板中提供一个文本框，用于批量维护需要忽略或恢复的文件路径规则（可支持简单通配符或特定路径格式）。  
   - 用户可在文本框中编辑完规则后，一次性点击“应用”按钮，实现文件名批量修改。  
3. 当前隐藏列表展示  
   - 在设置面板提供一个列表区，实时列出已被隐藏（文件名含“.”前缀）的文件，方便用户确认哪些文件处于忽略状态。  
4. 开关及操作反馈  
   - 对文本框内新加入或移除的规则，提供“应用忽略规则”或“回滚”按钮，支持一次性操作并提供进度或结果反馈，将大规模重命名的风险降至可控范围。

### 设置面板规划
1. 文本编辑框  
   - 允许用户添加或删除需要忽略的文件规则（如“myFolder/*”、“tempNotes/临时笔记.md”等）。  
   - 丰富的行内提示或校验机制，可视情况高亮无效规则。
2. “应用忽略规则”按钮  
   - 解析并应用文本编辑框中新增或删除的规则；  
   - 为匹配到需要忽略的文件添加“.”前缀，为不再匹配的已隐藏文件移除“.”前缀；  
   - 处理过程可提示用户：“正在处理第 X/Y 个文件…”，并在完成后弹出结果。
3. “回滚”功能  
   - 记录最后一次批量改名前的文件名状态，允许用户在短时间内一步回退，避免误操作造成大规模文件名错误。
4. “当前隐藏文件列表”  
   - 列表或表格形式，展示已添加“.”前缀的文件；  
   - 理想状态下，用户可在列表中点选“恢复”，单独移除其前缀。

### 功能边界与特殊情况
1. 单文件重复前缀  
   - 如文件本身就以多个“.”开头，需在界面或命令操作时提示“已隐藏”或默认跳过，避免重复加点。  
2. 恢复前缀冲突  
   - 如果有多个文件去点后重名，需弹出冲突提示并保留原名，或引导用户手动解决。  
3. 未保存文档与同步冲突  
   - 对打开但尚未保存的文件，执行加点/去点操作时需提示保存。  
   - 当用户开启了 Obsidian Sync 或其他同步插件，大量重命名操作可能触发同步冲突，需在文档或界面里提醒用户。  
4. 文件夹批量处理  
   - 若匹配规则指定了某文件夹，本插件会尝试对子文件批量执行操作，需在文档中明确“是否对文件夹本体加点”以及潜在冲突风险。

### 用户操作流程
1. 打开插件设置面板，或通过命令面板运行插件命令；  
2. 在文本编辑框中输入需要忽略的文件路径规则；  
3. 点击“应用忽略规则”按钮，插件解析规则并批量为匹配到的文件添加“.”前缀；  
4. 不再满足忽略规则的文件（但已含“.”）则自动去除“.”前缀，恢复显示；  
5. 若出现冲突或有错误，则显示提示信息并可选择“回滚”；  
6. 用户也可在侧栏/文件列表中右键单击单个文件，使用“添加隐藏前缀”/“取消隐藏前缀”进行单独操作。

### 非功能性需求
- 操作效率：支持数百乃至数千文件的批量前缀更新，不明显拖慢编辑器响应。  
- 兼容性：在 Windows、macOS、Linux 等平台上保持一致行为；针对 Obsidian Sync 或第三方云同步给出提示。  
- 可维护性：清晰的回滚机制、错误提示及日志有助于用户快速定位问题。

---

## 第三方视角下的改进与思考

1. 细化大规模改名时的提醒  
   - 若管理员在团队文档库中一次性对成千上万文件执行加点操作，最好在插件内提示“这可能引发大规模同步与冲突”。  
2. 预览改名列表  
   - 可选择在“应用忽略规则”前弹出预览弹窗，查看将被重命名的文件清单。对企业或大型项目尤其有用。  
3. 支持多级回滚或增量回滚  
   - 目前仅有“一步回滚”，可考虑在将来版本中扩展更多状态历史以供后续审计。  
4. 自定义隐藏标识  
   - 当前主要依赖 Obsidian 的默认隐藏机制（添加“.”），如果用户需要其他隐藏方法，文档可明确暂不支持或列入后续可能。  
5. 与其他插件的兼容  
   - 在文档中应提醒用户留意此插件对依赖特定文件名的其他插件的影响（如日记模板、特殊索引等）。

---

## 技术开发文档

以下针对实习生或新手开发者提供简要的技术实现指导，以便快速上手开发本插件。

### 1. 技术栈与依赖
- 语言：TypeScript（Obsidian 插件通常使用 TypeScript + Obsidian API）  
- 主要依赖：Obsidian 插件开发者工具（如 types for obsidian），Node.js 进行打包与编译。

### 2. 核心实现思路
1. 监听插件命令与设置面板事件：  
   - 当用户执行命令“添加隐藏前缀”或“取消隐藏前缀”时，通过 Obsidian 的文件操作 API（如 this.app.vault.rename()）重命名文件；  
   - 在设置面板，提供一个 TextArea 供用户编辑“忽略规则”，点击“应用”后，由插件解析规则并对匹配文件一键重命名。  
2. 文件匹配逻辑：  
   - 读取 vault 中所有文件或指定文件夹；  
   - 对照文本框中配置的规则（可简单按通配符匹配，或用正则处理），确定需要添加或移除前缀的文件名单。  
3. 回滚机制：  
   - 在执行大规模重命名前，记录所有文件原本的路径到一个临时状态；  
   - 如果在操作过程中发生中断或错误，用户点击“回滚”则恢复原路径。

### 3. 插件结构示例


### 4. 主要开发流程
1. 初始化插件：在 onload() 中注册命令、加载设置面板。  
2. 在设置面板上：  
   - 提供 TextArea，用于用户输入规则。  
   - 提供“应用规则”按钮，点击后触发批量重命名流程。  
   - 提供“回滚”按钮，恢复上一次操作前的状态。  
   - 显示“当前隐藏文件列表”。  
3. 实现批量重命名逻辑：  
   - 解析规则 -> 收集目标文件 -> 循环调用 this.app.vault.rename(oldPath, newPath)。  
4. 记录历史状态：  
   - 每次开始批量重命名前，保存当前操作目标文件的原始路径及新路径到内存或临时文件，用于回滚处理。

### 5. 注意事项
- 文件冲突：确保在 rename 时处理同名文件，避免覆盖或抛出异常。  
- 异步操作：Obsidian IO 操作通常是异步的，需使用 async/await 或 Promise 链接，避免 UI 阻塞或逻辑混乱。  
- 性能：建议对大规模文件操作进行分批，以免阻塞主线程或引发 UI 卡顿。  
- 兼容测试：在 Windows、macOS、Linux、移动端上进行简单测试，确认点前缀能正常隐藏、重命名不会引起同步端崩溃。  